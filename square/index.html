<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Square</title>
    <link rel="stylesheet" href="../style.css">
    <meta name="description" content="This is a simple svg generator where you can also see the angles, on this page you can create a square, but you can choose from; triangle, square, pentagon and hexagon">
</head>

<body>
    <div class="container">
        <svg width="100%" height="100%">
            <path id="path" d="M 100 100 L 300 100 L 300 300 L 100 300 Z" stroke="white" fill="transparent" />
            
            <circle id="p1" cx="100" cy="100" r="4" fill="grey" cursor="pointer" />
            <circle id="p2" cx="300" cy="100" r="4" fill="grey" cursor="pointer" />
            <circle id="p3" cx="300" cy="300" r="4" fill="grey" cursor="pointer" />
            <circle id="p4" cx="100" cy="300" r="4" fill="grey" cursor="pointer" />
        </svg>
        <div class="switch">
            <div>
                <a href="../triangle/">Triangle</a> <a href="#"><u>Square</u></a> <a href="../pentagon/">Pentagon</a> <a href="../hexagon/">Hexagon</a>
            </div>
            <a href="#" onclick="reset()">Reset</a>
        </div>

        <p id="angle1" class="angle">0°</p>
        <p id="angle2" class="angle">0°</p>
        <p id="angle3" class="angle">0°</p>
        <p id="angle4" class="angle">0°</p>

        <textarea type="text" id="pathDisplay" class="code" readonly></textarea>
        <button id="copyButton" onclick="copyText()" class="copy">Copy path</button>
        <p class="helloworld">by Rogier Goossen</p>
    </div>
</body>
</html>

<script>
const pathElement = document.getElementById('path');
const pathDisplay = document.getElementById('pathDisplay');
const copyButton = document.getElementById('copyButton');

function copyText() {
    navigator.clipboard.writeText(pathDisplay.value)
    copyButton.style.backgroundColor = "green";
    copyButton.innerHTML = "Copied!"

    setTimeout(() => {
        copyButton.style.backgroundColor = "#2D2D2D";
        copyButton.innerHTML = "Copy path"
    }, "1000");
}

function reset() {
    window.location.href = "../square";
}

const angleDisplays = [
    document.getElementById('angle1'),
    document.getElementById('angle2'),
    document.getElementById('angle3'),
    document.getElementById('angle4')
];

const points = [
    { circle: document.getElementById('p1'), x: 100, y: 100 },
    { circle: document.getElementById('p2'), x: 300, y: 100 },
    { circle: document.getElementById('p3'), x: 300, y: 300 },
    { circle: document.getElementById('p4'), x: 100, y: 300 }
];

function updateURL() {
    const pointString = points.map(p => `${p.x},${p.y}`).join(',');
    const newURL = `${window.location.pathname}?points=${pointString}`;
    history.replaceState(null, '', newURL);
}

function loadPathFromURL() {
    const params = new URLSearchParams(window.location.search);
    const pointsParam = params.get('points');
    
    if (pointsParam) {
        const coords = pointsParam.split(',').map(Number);
        if (coords.length === 8) {
            for (let i = 0; i < points.length; i++) {
                points[i].x = coords[i * 2];
                points[i].y = coords[i * 2 + 1];
                points[i].circle.setAttribute('cx', points[i].x);
                points[i].circle.setAttribute('cy', points[i].y);
            }
        }
    }
}

function updatePath() {
    const d = `M ${points[0].x} ${points[0].y} 
               L ${points[1].x} ${points[1].y} 
               L ${points[2].x} ${points[2].y} 
               L ${points[3].x} ${points[3].y} Z`;
    pathElement.setAttribute('d', d);
    pathDisplay.value = d.replace(/\s+/g, ' ').trim();
    calculateAngles();
    updateURL();
}

function calculateAngles() {
    for (let i = 0; i < points.length; i++) {
        const P1 = points[i];

        const P0 = points[(i - 1 + points.length) % points.length];
        const P2 = points[(i + 1) % points.length];
        
        const vectorA = { x: P0.x - P1.x, y: P0.y - P1.y };
        const vectorB = { x: P2.x - P1.x, y: P2.y - P1.y };
        
        const dotProduct = (vectorA.x * vectorB.x) + (vectorA.y * vectorB.y);
        const magnitudeA = Math.sqrt(vectorA.x ** 2 + vectorA.y ** 2);
        const magnitudeB = Math.sqrt(vectorB.x ** 2 + vectorB.y ** 2);
        
        const angleRadians = Math.acos(dotProduct / (magnitudeA * magnitudeB));
        const angleDegrees = angleRadians * (180 / Math.PI);
        
        angleDisplays[i].textContent = angleDegrees.toFixed(2) + "°";
        angleDisplays[i].style.left = `${P1.x + 10}px`;
        angleDisplays[i].style.top = `${P1.y - 20}px`;
    }
}

let selectedPoint = null;

points.forEach(point => {
    point.circle.addEventListener('mousedown', (e) => {
        selectedPoint = point;
    });
});

document.addEventListener('mousemove', (e) => {
    if (selectedPoint) {
        selectedPoint.x = e.offsetX;
        selectedPoint.y = e.offsetY;
        selectedPoint.circle.setAttribute('cx', selectedPoint.x);
        selectedPoint.circle.setAttribute('cy', selectedPoint.y);
        updatePath();
    }
});

document.addEventListener('mouseup', () => {
    selectedPoint = null;
});

loadPathFromURL();
updatePath();
</script>
