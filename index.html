<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SVGangle generator</title>
    <link rel="stylesheet" href="/style.css">
    <meta name="keywords" content="JavaScript, SVG, Angle">
    <meta name="author" content="Rogier Goossen">
    <meta name="description" content="This is a simple svg generator where you can also see the angles, you can add however many points you want to create your desired shape.">
</head>
<body>
    <div class="container" id="container">
        <svg>
            <path id="path" d="M 200 100 L 300 300 L 100 300 Z" stroke="white" fill="transparent" />
            
            <circle id="p1" cx="200" cy="100" r="4" fill="grey" cursor="pointer" />
            <circle id="p2" cx="300" cy="300" r="4" fill="grey" cursor="pointer" />
            <circle id="p3" cx="100" cy="300" r="4" fill="grey" cursor="pointer" />
        </svg>
        <div class="controller">
            <a href="#" onclick="addNewPoint()">Add point</a>
            <a href="#" onclick="reset()">Reset</a>
        </div>

        <p id="angle1" class="angle">0°</p>
        <p id="angle2" class="angle">0°</p>
        <p id="angle3" class="angle">0°</p>

        <textarea type="text" id="pathDisplay" readonly></textarea>
        <button id="copyButton" onclick="copyText()">Copy path</button>
        <p class="helloworld">by Rogier Goossen</p>
    </div>
</body>
</html>

<script>
const pathElement = document.getElementById('path');
const pathDisplay = document.getElementById('pathDisplay');
const copyButton = document.getElementById('copyButton');

const angleDisplays = [
    document.getElementById('angle1'),
    document.getElementById('angle2'),
    document.getElementById('angle3')
];

const points = [
    { circle: document.getElementById('p1'), x: 200, y: 100 },
    { circle: document.getElementById('p2'), x: 300, y: 300 },
    { circle: document.getElementById('p3'), x: 100, y: 300 }
];

function copyText() {
    navigator.clipboard.writeText(pathDisplay.value);
    copyButton.style.backgroundColor = "green";
    copyButton.innerHTML = "Copied!";

    setTimeout(() => {
        copyButton.style.backgroundColor = "#2D2D2D";
        copyButton.innerHTML = "Copy path";
    }, "1000");
}

function reset() {
    window.location.href = "../";
}

let pointCount = 3;

function addNewPoint() {
    //change this later
    addPoint(200, 200);
}

function addPoint(x, y) {
    const newPoint = createPoint(x, y);
    
    document.querySelector("svg").appendChild(newPoint.circle);
    points.push(newPoint);

    const angleContainer = document.getElementById("container");
    const angleDisplay = createAngleDisplay(x, y);

    angleContainer.appendChild(angleDisplay);
    angleDisplays.push(angleDisplay);
    pointCount++;

    updatePath();
}

function createPoint(x, y) {
    const newPoint = {
        x: x,
        y: y,
        circle: document.createElementNS("http://www.w3.org/2000/svg", "circle")
    };

    newPoint.circle.setAttribute("cx", x);
    newPoint.circle.setAttribute("cy", y);
    newPoint.circle.setAttribute("r", 4);
    newPoint.circle.setAttribute("fill", "grey");
    newPoint.circle.setAttribute("cursor", "pointer");
    newPoint.circle.addEventListener("mousedown", () => selectedPoint = newPoint);

    return newPoint;
}

function createAngleDisplay(x, y) {
    const angleDisplay = document.createElement("p");
    angleDisplay.className = "angle";
    angleDisplay.textContent = "0°";
    angleDisplay.style.left = `${x + 10}px`;
    angleDisplay.style.top = `${y - 20}px`;

    return angleDisplay;
}

function updateURL() {
    const pointString = points.map(p => `${p.x},${p.y}`).join(',');
    const newURL = `${window.location.pathname}?points=${pointString}`;
    history.replaceState(null, '', newURL);
}

function loadPathFromURL() {
    const params = new URLSearchParams(window.location.search);
    const pointsParam = params.get('points');
    
    if (pointsParam) {
        const coords = pointsParam.split(',').map(Number);

        for (let i = 0; i < coords.length / 2; i++) {
            const newX = coords[i * 2];
            const newY = coords[i * 2 + 1];
            
            if (i < points.length) {
                points[i].x = newX;
                points[i].y = newY;
                points[i].circle.setAttribute('cx', newX);
                points[i].circle.setAttribute('cy', newY);
            } else {
                addPoint(newX, newY);
            }
        }
    }
    updatePath();
}

function updatePath() {
    const d = points.map((p, i) => (i === 0 ? `M ${p.x} ${p.y}` : `L ${p.x} ${p.y}`)).join(' ') + " Z";
    pathElement.setAttribute('d', d);
    pathDisplay.value = d.replace(/\s+/g, ' ').trim();
    calculateAngles();
    updateURL();
}

function calculateAngles() {
    points.forEach((P1, i) => {
        const P0 = points[(i - 1 + points.length) % points.length];
        const P2 = points[(i + 1) % points.length];
        
        const vectorA = { x: P0.x - P1.x, y: P0.y - P1.y };
        const vectorB = { x: P2.x - P1.x, y: P2.y - P1.y };
        
        const dotProduct = (vectorA.x * vectorB.x) + (vectorA.y * vectorB.y);
        const magnitudeA = Math.sqrt(vectorA.x ** 2 + vectorA.y ** 2);
        const magnitudeB = Math.sqrt(vectorB.x ** 2 + vectorB.y ** 2);
        
        const angleRadians = Math.acos(dotProduct / (magnitudeA * magnitudeB));
        const angleDegrees = angleRadians * (180 / Math.PI);
        
        angleDisplays[i].textContent = angleDegrees.toFixed(2) + "°";
        angleDisplays[i].style.left = `${P1.x + 10}px`;
        angleDisplays[i].style.top = `${P1.y - 20}px`;
    });
}

let selectedPoint = null;

points.forEach(point => {
    point.circle.addEventListener('mousedown', (e) => {
        selectedPoint = point;
    });
});

const svgElement = document.querySelector('svg');

svgElement.addEventListener('mousemove', (e) => {
    if (selectedPoint) {
        const newX = e.offsetX;
        const newY = e.offsetY;

        if (newX >= 0 && newX <= 400 && newY >= 0 && newY <= 400) {
            selectedPoint.x = newX;
            selectedPoint.y = newY;
            selectedPoint.circle.setAttribute('cx', selectedPoint.x);
            selectedPoint.circle.setAttribute('cy', selectedPoint.y);
            updatePath();
        }
    }
});

document.addEventListener('mouseup', () => {
    selectedPoint = null;
});

loadPathFromURL();
updatePath();
</script>
